#!/usr/bin/env node

const Encryptor = require('../src/lib/encrypt')
const fs = require('fs')
const transformator = require('../src/transformation')

const path='sample/unpack'

var enc=new Encryptor(true)

var command= {
    ca: { until: 234823984},
    tr: [
        ['in-file', {att: '0', m: 'image/jpg' }],
        ['rotate', {degrees: 45 }],
//        ['grayscale'],
        ['out', { m: 'image/png' }]
    ],

    att: { '0': 'sample/family-2811003_1280.jpg' }
}

//console.log(commands)

async function run() {
    await enc.encrypt(command,
                      await fs.promises.readFile('sample/priv.key'),
                      'sample/prepared.bin'
                     );


    var com = await enc.decrypt(
        await fs.promises.readFile('sample/pub.key'),
        await fs.promises.readFile('sample/prepared.bin'),
        'sample/unpack'
    )

    var trans=new transformator(com, path, true);
    trans.explain();
    await trans.execute();




}

run()
